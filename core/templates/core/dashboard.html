{% extends 'base.html' %}
{% block title %}THE_SERV_1 | Dashboard{% endblock %}
{% block content %}
<div class="grid md:grid-cols-2 gap-8 animate-fadein">
  <!-- Motorbikes Card -->
  <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-2xl shadow-lg p-6 border border-blue-200 animate-card transition duration-500 hover:scale-105 hover:shadow-2xl">
    <div class="flex items-center justify-between mb-4">
      <h3 class="font-bold text-lg text-blue-900">üö≤ My Motorbikes</h3>
      <a href="{% url 'bike_add' %}" class="px-3 py-1 bg-blue-600 text-white rounded-lg shadow hover:bg-blue-700 transition">+ Add</a>
    </div>
    <ul class="space-y-3">
      {% for b in bikes %}
  <li class="bg-white rounded-xl shadow flex flex-col md:flex-row md:items-center justify-between px-4 py-3 border border-blue-100 hover:shadow-xl transition duration-300 animate-list hover:scale-105">
          <div class="font-medium text-blue-800">#{{ b.id }} {{ b.brand }} {{ b.model }} <span class="text-gray-400">({{ b.plate_number|default:'-' }})</span></div>
          <div class="mt-2 md:mt-0 flex gap-2">
            <a class="px-3 py-1 bg-yellow-400 text-white rounded hover:bg-yellow-500 transition duration-200 transform hover:scale-105" href="{% url 'bike_edit' b.id %}">Edit</a>
            <a class="px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600 transition duration-200 transform hover:scale-105" href="{% url 'bike_delete' b.id %}">Delete</a>
          </div>
        </li>
      {% empty %}
        <li class="text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏ñ‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</li>
      {% endfor %}
    </ul>
  </div>

  <!-- Bookings Card -->
  <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-2xl shadow-lg p-6 border border-green-200 animate-card transition duration-500 hover:scale-105 hover:shadow-2xl">
    <div class="flex items-center justify-between mb-4">
      <h3 class="font-bold text-lg text-green-900">üìÖ {% if is_mechanic %}All Bookings{% else %}My Bookings & Status{% endif %}</h3>
      <a href="{% url 'booking_add' %}" class="px-3 py-1 bg-green-600 text-white rounded-lg shadow hover:bg-green-700 transition">+ Create</a>
    </div>
    <ul class="space-y-3">
      {% for bk in bookings %}
        <li class="bg-white rounded-xl shadow flex flex-col md:flex-row md:items-center justify-between px-4 py-3 border border-green-100 hover:shadow-xl transition duration-300 animate-list hover:scale-105">
          <div class="font-medium text-green-800">
            #{{ bk.id }} ‚Ä¢ <span class="text-blue-700">{{ bk.bike.brand }} {{ bk.bike.model }}</span> ‚Ä¢ {{ bk.service_type }} ‚Ä¢ <span class="text-gray-500">{{ bk.booking_date }} {{ bk.booking_time }}</span>
            <span class="ml-2 px-3 py-1 rounded-full text-xs font-bold shadow-lg transition duration-300
              {% if bk.status == 'pending' %}bg-gray-300 text-gray-700{% elif bk.status == 'confirmed' %}bg-yellow-400 text-yellow-900{% elif bk.status == 'in_progress' %}bg-blue-400 text-white{% elif bk.status == 'done' %}bg-green-500 text-white{% elif bk.status == 'cancelled' %}bg-red-400 text-white{% endif %}">
              {{ bk.get_status_display }}
            </span>
            {% if bk.pickup_date %}
              <span class="ml-2 text-xs text-green-700">‡∏ß‡∏±‡∏ô‡∏£‡∏±‡∏ö‡∏£‡∏ñ: {{ bk.pickup_date }}</span>
            {% endif %}
            {% if bk.price %}
              <span class="ml-2 text-xs text-indigo-700">‡∏£‡∏≤‡∏Ñ‡∏≤: {{ bk.price }} ‡∏ö‡∏≤‡∏ó</span>
            {% endif %}
            {% if is_mechanic %}
              <span class="ml-2 text-xs text-gray-400">‡πÇ‡∏î‡∏¢ {{ bk.user.username }}</span>
            {% endif %}
          </div>
          <div class="mt-2 md:mt-0 flex gap-2">
            {% if bk.user == user %}
              <a class="px-3 py-1 bg-yellow-400 text-white rounded hover:bg-yellow-500 transition duration-200 transform hover:scale-105" href="{% url 'booking_edit' bk.id %}">Edit</a>
              <a class="px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600 transition duration-200 transform hover:scale-105" href="{% url 'booking_delete' bk.id %}">Delete</a>
            {% endif %}
          </div>
        </li>
      {% empty %}
        <li class="text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</li>
      {% endfor %}
    </ul>
  </div>
</div>

<!-- Chart Card -->
<div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-2xl shadow-lg p-6 border border-purple-200 mt-10 max-w-2xl mx-auto animate-card transition duration-500 hover:scale-105 hover:shadow-2xl">
  <h3 class="font-bold text-lg text-purple-900 mb-4 flex items-center gap-2">üìä Booking Status Chart</h3>
  <div id="chart-container">
    <canvas id="statusChart" height="100" style="display:none;"></canvas>
    <div id="no-data" class="text-center text-gray-500 py-8 text-lg" style="display:none;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{{ labels|json_script:"labels-data" }}
{{ counts|json_script:"counts-data" }}
<script>
  const labels = JSON.parse(document.getElementById("labels-data").textContent);
  const counts = JSON.parse(document.getElementById("counts-data").textContent);
  if (counts.length === 0) {
    document.getElementById('statusChart').style.display = 'none';
    document.getElementById('no-data').style.display = 'block';
  } else {
    document.getElementById('statusChart').style.display = 'block';
    document.getElementById('no-data').style.display = 'none';
    new Chart(document.getElementById('statusChart').getContext('2d'), {
      type: 'pie',
      data: {
        labels: labels,
        datasets: [{
          data: counts,
          backgroundColor: ['#fbbf24','#60a5fa','#34d399','#f87171'],
        }]
      },
      options: {
        plugins: {
          legend: {
            position: 'bottom',
            labels: { color: '#6b21a8', font: { size: 16, weight: 'bold' } }
          }
        }
      }
    });
  }
</script>
<style>
  /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏á‡∏≤‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡πÇ‡∏Ñ‡πâ‡∏á‡∏°‡∏ô‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ö scrollbar */
  ::-webkit-scrollbar {
    width: 8px;
    background: #f3f4f6;
    border-radius: 8px;
  }
  ::-webkit-scrollbar-thumb {
    background: #a5b4fc;
    border-radius: 8px;
  }
  /* Animation keyframes */
  @keyframes fadein {
    from { opacity: 0; }
    to { opacity: 1; }
  }
  @keyframes card {
    from { opacity: 0; transform: translateY(30px) scale(0.98); }
    to { opacity: 1; transform: translateY(0) scale(1); }
  }
  @keyframes list {
    from { opacity: 0; transform: translateX(-30px); }
    to { opacity: 1; transform: translateX(0); }
  }
  .animate-fadein { animation: fadein 0.7s cubic-bezier(.4,0,.2,1) both; }
  .animate-card { animation: card 0.8s cubic-bezier(.4,0,.2,1) both; }
  .animate-list { animation: list 0.7s cubic-bezier(.4,0,.2,1) both; }
</style>
{% endblock %}
